---
layout: post
title: Java项目构建(0)
categories: []
tags: []
published: True

---
---
接触的Java项目越来越多，我发现很多Java程序猿的Java项目只能依赖一个特定的工具，或者Eclipse，或者Intellj。编译部署的方式也是落后到让人吃惊，人肉更改配置文件，用IED打包成war包，通过可视化工具拉到服务器，重启tomcat...

作为Java程序猿，不可能不知道Spring，用Spring的程序猿大多数都知道Maven，不过很令人遗憾的是很多Java程序猿对Maven的理解停留在依赖管理。

平常的java开发过程中，我们会使用到很多配置文件，比如下面这样

<img src="{{ site.url }}/assets/images/20151127/p1.png" />

这还是普通小项目的配置文件，其实真实开发过程中很多项目配置文件之繁琐简直叹为观止，令人发指。
当我们在开发环境，测试环境，生产环境中不断切换，重复修改这些繁琐的配置文件的时候，很多程序猿相信自己能像驾驭自己多个女朋友那样轻易驾驭这一千几百个配置选项，能在它们中自由穿梭，游刃有余。但据不完全统计，很多时候我们还是可以看到有些程序猿把自己辛辛苦苦写好的代码发布到测试或者正式环境后，发现代码并没有按照自己愿意跑起来，于是费尽脑筋满头大汗百思不得其解，最后在加班加点到夜深人静的时候终于顿悟，某个配置文件忘改了，此时心中1024头草泥马在奔腾。

有些聪明的程序猿为了方便快速更改不同的配置文件，他们的配置文件是这样的。

<img src="{{ site.url }}/assets/images/20151127/p6.png" />
其实解决这个问题最好的方法是在开发过程中维护好不同环境的配置文件，让熟悉相应配置的成员维护相应的配置文件。于是配置文件的目录结构应该变成下面这样。

<img src="{{ site.url }}/assets/images/20151127/p2.png" />

不熟悉Maven profile的人可能很费解，上面这样目录结构，程序在运行的时候该读哪个配置文件呢？
这时候Maven profile就能帮上忙了。

profile可以让我们定义一系列的配置信息，然后指定其激活条件。这样我们就可以定义多个profile，然后每个profile对应不同的激活条件和配置信息，从而达到不同环境使用不同配置信息的效果。

Maven给我们提供了多种不同的profile激活方式。比如我们可以使用-P参数显式的激活一个profile，也可以根据不同的环境来自动激活，比如根据操作系统的不同激活不同的profile，也可以根据jdk版本的不同激活不同的profile，等等。

Maven的profile可以定义在Maven的settings.xml中，实际应用中我们一般定义在项目的pom.xml中，例如下面这样。

<img src="{{ site.url }}/assets/images/20151127/p3.png" />

然后配置打包插件根据不同的环境变量打包。

<img src="{{ site.url }}/assets/images/20151127/p4.png" />

运行Maven打包命令，只要带上不同的profileId就能正确把不同环境的配置文件打包进去。例如运行 mvn -Pdev package，能看到Maven会自动把dev这个文件夹下面的配置文件打包进去。

<img src="{{ site.url }}/assets/images/20151127/p5.png" />

其实用好Maven profile，还能避免很多不必要的坑。有同事为了在某环境发布一个版本，直接在那个环境的服务器上面的git仓库改了配置，但代码他不敢提交，因为会影响其他环境。等到有一天另外一个同事更改了相同的配置文件，这时候问题就来了，另外那个同事必须要commit服务器上面那些他不熟悉的更改才能把他的代码pull到服务器，只能找来原来的同事来看回之前的配置文件，一起慢慢merge。恩，这种问题挺起来很stupid，但我确实遇到过几次。

平时开发过程中，我们尽量做到只维护一份代码，让团队里面的每个人对整个项目都由整体的认识，每个人都能方便地开发编译部署，在不同的环境可以灵活的切换（当然，生产环境有些配置只能相应的人员知道）。

顺便提一下，Gradle和Maven同样是自动化构建工具，但按照目前的发展情况看，Gradle的风头已经盖过了Maven。Gradle给人感觉最大的变化是简洁，Gradle放弃了Maven的基于XML的繁琐配置，基于Groovy的紧凑脚本实在让人爱不释手，在表述意图方面也没有什么不清晰的地方。另外一方面是灵活，各种在Maven中难以下手的事情，在Gradle就是小菜一碟，比如修改现有的构建生命周期，几行配置就完成了，同样的事情，在Maven中你必须编写一个插件，那对于一个刚入门的用户来说，花上一两天也不一定能搞定。

扯远了，回到Maven profile吧。总之，用好Maven profile就可以节省80%的精力，提高90%的效率，关键是让你早点下班回家了。

这是Java项目构建(0)，也许还有（1），（2），（3）...
当然，也许只是也许。






